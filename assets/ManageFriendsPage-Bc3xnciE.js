import{r as d,A as R,u as D,j as s,H as y,F as B,a as o,h as F}from"./index-CF71GRAX.js";const w="_container_6hq6f_1",$="_page_6hq6f_11",A="_title_6hq6f_22",P="_tabs_6hq6f_28",L="_tab_6hq6f_28",U="_active_6hq6f_50",S="_content_6hq6f_56",E="_section_6hq6f_64",K="_input_6hq6f_75",M="_friendList_6hq6f_83",H="_btnPrimary_6hq6f_94",T="_btnDanger_6hq6f_109",O="_btnBack_6hq6f_123",V="_feedback_6hq6f_139",z="_friendBar_6hq6f_150",G="_friendInfo_6hq6f_165",J="_buttonContainer_6hq6f_172",Q="_friendImage_6hq6f_181",W="_avatar_6hq6f_190",X="_friendName_6hq6f_199",Y="_friendId_6hq6f_205",Z="_friendLink_6hq6f_210",n={container:w,page:$,title:A,tabs:P,tab:L,active:U,content:S,section:E,input:K,friendList:M,btnPrimary:H,btnDanger:T,btnBack:O,feedback:V,friendBar:z,friendInfo:G,buttonContainer:J,friendImage:Q,avatar:W,friendName:X,friendId:Y,friendLink:Z};function te(){const{user:i}=d.useContext(R),b=D(),[l,u]=d.useState("add"),[g,x]=d.useState(""),[a,c]=d.useState(""),[f,j]=d.useState(null);d.useEffect(()=>{(async()=>{if(i?.publicID)try{const m={...(await o.post("undefined/api/users/friendlist",{publicID:i.publicID})).data.friends},k=await Promise.all((m.User||[]).map(async p=>{const C=await o.get(`undefined/api/users/${encodeURIComponent(p.user)}`);return{...p,...C.data.user}}));m.User=k,j(m)}catch(t){console.error("Failed to fetch friends:",t)}})()},[i]);const r=f?Object.values(f).flat().filter(e=>e.source==="User"):[],v=async e=>{try{const t=await o.post(`undefined/friends/add/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Request sent!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},N=async e=>{try{const t=await o.post(`undefined/friends/accept/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Request accepted!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},_=async e=>{try{const t=await o.post(`undefined/friends/reject/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Request rejected!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},q=async e=>{try{const t=await o.post(`undefined/friends/remove/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Friend removed!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},h=(e,t)=>s.jsxs("li",{className:n.friendBar,children:[s.jsx("div",{className:n.friendImage,children:s.jsx("img",{src:e.avatar||e.profilePicture||"https://digitalhealthskills.com/wp-content/uploads/2022/11/3da39-no-user-image-icon-27.png",alt:e.displayName||"Friend avatar",className:n.avatar})}),s.jsxs("div",{className:n.friendInfo,children:[s.jsx("div",{className:n.friendName,children:e.displayName||e.name||"Unknown"}),s.jsxs("div",{className:n.friendId,children:["UserID: ",e.publicID]}),s.jsx(F,{to:`/friends/viewprofile/${e.publicID}`,className:n.friendLink,children:"View Profile"})]}),s.jsx("div",{className:n.buttonContainer,children:t})]},e.user),I=()=>{switch(l){case"add":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Add Friend"}),s.jsx("input",{type:"text",placeholder:"Enter UserID",className:n.input,onChange:e=>x(e.target.value)}),s.jsx("button",{className:n.btnPrimary,onClick:()=>v(g),children:"Send Request"}),a&&s.jsx("p",{className:n.feedback,children:a})]});case"sent":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Pending Requests (Sent)"}),s.jsx("ul",{className:n.friendList,children:r.filter(e=>e.status==="pending"&&e.requestedByMe).length?r.filter(e=>e.status==="pending"&&e.requestedByMe).map(e=>h(e,s.jsx("button",{className:n.btnDanger,onClick:()=>_(e.user),children:"Cancel"}))):s.jsx("li",{children:"No pending requests sent"})}),a&&s.jsx("p",{className:n.feedback,children:a})]});case"received":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Pending Requests (Received)"}),s.jsx("ul",{className:n.friendList,children:r.filter(e=>e.status==="pending"&&!e.requestedByMe).length?r.filter(e=>e.status==="pending"&&!e.requestedByMe).map(e=>h(e,s.jsxs(s.Fragment,{children:[s.jsx("button",{className:n.btnPrimary,onClick:()=>N(e.user),children:"Accept"}),s.jsx("button",{className:n.btnDanger,onClick:()=>_(e.user),children:"Reject"})]}))):s.jsx("li",{children:"No pending requests received"})}),a&&s.jsx("p",{className:n.feedback,children:a})]});case"remove":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Remove Friend"}),s.jsx("ul",{className:n.friendList,children:r.filter(e=>e.status==="accepted").length?r.filter(e=>e.status==="accepted").map(e=>h(e,s.jsx("button",{className:n.btnDanger,onClick:()=>q(e.user),children:"Remove"}))):s.jsx("li",{children:"No friends to remove"})}),a&&s.jsx("p",{className:n.feedback,children:a})]});default:return null}};return s.jsxs("div",{className:n.container,children:[s.jsx(y,{}),s.jsxs("div",{className:n.page,children:[s.jsx("h1",{className:n.title,children:"Manage Friends"}),s.jsxs("div",{className:n.tabs,children:[s.jsx("button",{className:`${n.tab} ${l==="add"?n.active:""}`,onClick:()=>u("add"),children:"Add Friend"}),s.jsx("button",{className:`${n.tab} ${l==="sent"?n.active:""}`,onClick:()=>u("sent"),children:"Pending Sent"}),s.jsx("button",{className:`${n.tab} ${l==="received"?n.active:""}`,onClick:()=>u("received"),children:"Pending Received"}),s.jsx("button",{className:`${n.tab} ${l==="remove"?n.active:""}`,onClick:()=>u("remove"),children:"Remove Friend"})]}),s.jsx("div",{className:n.content,children:I()}),s.jsx("button",{className:n.btnBack,onClick:()=>b("/friends"),children:"â† Back to Friends"})]}),s.jsx(B,{})]})}export{te as default};
