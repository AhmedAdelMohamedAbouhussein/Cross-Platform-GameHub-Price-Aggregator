import{g as O,j as e,u as S,r as m,A as E,H as G,c as k,F,a as w}from"./index-OB99FTZL.js";import{A as I}from"./Aside-B7IN9aoi.js";import"./index-I2XW_8mK.js";var v={exports:{}},j,P;function W(){if(P)return j;P=1;var s="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return j=s,j}var T,b;function A(){if(b)return T;b=1;var s=W();function o(){}function i(){}return i.resetWarningCache=o,T=function(){function r(y,_,n,a,x,g){if(g!==s){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}r.isRequired=r;function t(){return r}var l={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:t,element:r,elementType:r,instanceOf:t,node:r,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:i,resetWarningCache:o};return l.PropTypes=l,l},T}var R;function L(){return R||(R=1,v.exports=A()()),v.exports}var D=L();const p=O(D),q="_card_1mlff_1",B="_defaultOverlay_1mlff_30",$="_progressWrapper_1mlff_40",z="_cardImage_1mlff_59",M="_classTitle_1mlff_78",h={card:q,defaultOverlay:B,progressWrapper:$,cardImage:z,classTitle:M},U="_progressCircle_q6ean_1",H="_progressCircleText_q6ean_12",C={progressCircle:U,progressCircleText:H};function K({progress:s}){const r=2*Math.PI*45,t=r*(1-s/100);return e.jsxs("svg",{width:"100",height:"100",className:C.progressCircle,children:[e.jsx("circle",{cx:"50",cy:"50",r:45,stroke:"#e6e6e6",strokeWidth:10,fill:"none"}),e.jsx("circle",{cx:"50",cy:"50",r:45,stroke:"#4caf50",strokeWidth:10,fill:"none",strokeDasharray:r,strokeDashoffset:t,strokeLinecap:"round",transform:"rotate(-90 50 50)"}),e.jsxs("text",{x:"50%",y:"50%",textAnchor:"middle",dy:"0.3em",className:C.progressCircleText,children:[s,"%"]})]})}function N(s){const o=s.id,i=s.platform.trim(),r=s.title,t=s.image.trim()!==""?s.image:"https://static.vecteezy.com/system/resources/previews/008/255/804/non_2x/page-not-found-error-404-system-updates-uploading-computing-operation-installation-programs-system-maintenance-graffiti-sprayed-page-not-found-error-404-isolated-on-white-background-vector.jpg",l=s.progress,y=s.lastPlayed?new Date(s.lastPlayed).toLocaleDateString():"Game hasn't been played",_=s.hoursPlayed,n=S(),a=m.useRef(null),[x,g]=m.useState(!1);return m.useEffect(()=>{const d=new IntersectionObserver(f=>{f.forEach(c=>{c.isIntersecting&&(console.log(`Card ${r} is now visible`),g(!0),d.disconnect())})},{threshold:.2});return a.current&&d.observe(a.current),()=>{a.current&&d.unobserve(a.current)}},[]),e.jsx("div",{ref:a,className:h.card,onClick:()=>n(`/ownedgamedetails?platform=${i}&id=${o}`),children:x?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t,alt:r+" picture",loading:"lazy",className:h.cardImage}),e.jsx("h2",{className:h.classTitle,children:s.title}),e.jsxs("p",{children:["Bought on: ",i]}),e.jsx("div",{className:h.progressWrapper,children:e.jsx(K,{progress:l})}),e.jsx("div",{className:h.defaultOverlay,children:e.jsx("p",{children:"Hover to see progress"})}),e.jsxs("p",{children:["Total Hours: ",_]}),e.jsxs("p",{children:["Last Played: ",y]})]}):e.jsx("div",{className:h.placeholder,children:"Loading..."})})}N.propTypes={title:p.string.isRequired,image:p.string,platform:p.string,progress:p.number,lastPlayed:p.oneOfType([p.string,p.instanceOf(Date)])};const V="_container_1xwzh_1",Y="_body_1xwzh_9",J="_main_1xwzh_15",Q="_toppanel_1xwzh_23",X="_refreshButton_1xwzh_26",Z="_spin_1xwzh_44",ee="_cardGrid_1xwzh_54",u={container:V,body:Y,main:J,toppanel:Q,refreshButton:X,spin:Z,cardGrid:ee};function ae(){const{user:o}=m.useContext(E),[i,r]=m.useState(null);m.useEffect(()=>{window.scrollTo(0,0);const n=async()=>{try{const a=await w.post("undefined/api/users/ownedgames",{userId:o._id});r(a.data.ownedGames),console.log("Fetched owned games:",a.data.ownedGames)}catch(a){console.error("Fetch failed:",a)}};o?._id&&n()},[]);const[t,l]=m.useState(!1),y=async()=>{if(!t){l(!0);try{await w.post("undefined/refresh/refreshOwnedGames",{},{withCredentials:!0});const n=await w.post("undefined/api/users/ownedgames",{userId:o._id});r(n.data.ownedGames),console.log("Refreshed owned games:",n.data.ownedGames)}catch(n){console.error("Failed to refresh games:",n)}finally{l(!1)}}},_=()=>{if(!i)return e.jsx("p",{children:"Loading games..."});const n=new Map(Object.entries(i));return Array.from(n.entries()).flatMap(([a,x])=>{const g=new Map(Object.entries(x));return Array.from(g.entries()).sort((f,c)=>c[1].progress-f[1].progress).map(([f,c])=>e.jsx(N,{id:f,platform:a,image:c.coverImage,title:c.gameName,progress:c.progress,lastPlayed:c.lastPlayed,hoursPlayed:c.hoursPlayed},`${a}-${f}`))})};return e.jsxs("div",{className:u.container,children:[e.jsx(G,{}),e.jsxs("div",{className:u.body,children:[e.jsx(I,{}),e.jsxs("main",{className:u.main,children:[e.jsx("div",{className:u.toppanel,children:e.jsxs("button",{className:u.refreshButton,onClick:y,disabled:t,children:[e.jsx(k,{className:t?u.spin:""}),t?" Refreshing...":" Refresh Library"]})}),e.jsx("div",{className:u.cardGrid,children:_()})]})]}),e.jsx(F,{})]})}export{ae as default};
