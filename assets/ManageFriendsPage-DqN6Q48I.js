import{r as d,A as v,b as q,j as e,H as k,F as C,a as l}from"./index-DSqZDtMD.js";const y="_container_bz21q_1",B="_page_bz21q_11",R="_title_bz21q_22",w="_tabs_bz21q_28",A="_tab_bz21q_28",$="_active_bz21q_50",z="_content_bz21q_56",F="_section_bz21q_64",D="_input_bz21q_75",P="_friendList_bz21q_83",S="_friendBar_bz21q_94",E="_btnPrimary_bz21q_109",L="_btnDanger_bz21q_124",U="_btnBack_bz21q_138",I="_feedback_bz21q_154",K="_buttonContainer_bz21q_165",t={container:y,page:B,title:R,tabs:w,tab:A,active:$,content:z,section:F,input:D,friendList:P,friendBar:S,btnPrimary:E,btnDanger:L,btnBack:U,feedback:I,buttonContainer:K};function O(){const{user:r}=d.useContext(v),h=q(),[o,u]=d.useState("add"),[_,p]=d.useState(""),[a,c]=d.useState(""),[b,x]=d.useState(null);d.useEffect(()=>{const s=async()=>{try{const n=await l.post("undefined/api/users/friendlist",{userId:r._id});x(n.data.friends),console.log("Fetched friends:",n.data.friends)}catch(n){console.error("Failed to fetch friends:",n)}};r?._id&&s()},[r,void 0]);const i=b?Object.values(b).flat().filter(s=>s.source==="User"):[],j=async s=>{try{const n=await l.post(`undefined/friends/add/${s}`,{userId:r._id});c(n.data.message||"Request sent!")}catch(n){c(n.response?.data?.message||"Something went wrong.")}},g=async s=>{try{const n=await l.post(`undefined/friends/accept/${s}`,{userId:r._id});c(n.data.message||"Request accepted!")}catch(n){c(n.response?.data?.message||"Something went wrong.")}},m=async s=>{try{const n=await l.post(`undefined/friends/reject/${s}`,{userId:r._id});c(n.data.message||"Request rejected!")}catch(n){c(n.response?.data?.message||"Something went wrong.")}},N=async s=>{try{const n=await l.post(`undefined/friends/remove/${s}`,{userId:r._id});c(n.data.message||"Friend removed!")}catch(n){c(n.response?.data?.message||"Something went wrong.")}},f=()=>{switch(o){case"add":return e.jsxs("div",{className:t.section,children:[e.jsx("h2",{children:"Add Friend"}),e.jsx("input",{type:"text",placeholder:"Enter UserID",className:t.input,onChange:s=>p(s.target.value)}),e.jsx("button",{className:t.btnPrimary,onClick:()=>j(_),children:" Send Request "}),a&&e.jsx("p",{className:t.feedback,children:a})]});case"sent":return e.jsxs("div",{className:t.section,children:[e.jsx("h2",{children:"Pending Requests (Sent)"}),e.jsx("ul",{className:t.friendList,children:i.filter(s=>s.status==="pending"&&s.requestedByMe).length?i.filter(s=>s.status==="pending"&&s.requestedByMe).map((s,n)=>e.jsxs("li",{className:t.friendBar,children:[e.jsx("span",{children:s.displayName||"Unknown"}),e.jsx("button",{className:t.btnDanger,onClick:()=>m(s.user),children:" Cancel "})]},n)):e.jsx("li",{children:"No pending requests sent"})}),a&&e.jsx("p",{className:t.feedback,children:a})]});case"received":return e.jsxs("div",{className:t.section,children:[e.jsx("h2",{children:"Pending Requests (Received)"}),e.jsx("ul",{className:t.friendList,children:i.filter(s=>s.status==="pending"&&!s.requestedByMe).length?i.filter(s=>s.status==="pending"&&!s.requestedByMe).map((s,n)=>e.jsxs("li",{className:t.friendBar,children:[e.jsx("span",{children:s.displayName||"Unknown"}),e.jsxs("div",{className:t.buttonContainer,children:[e.jsx("button",{className:t.btnPrimary,onClick:()=>g(s.user),children:" Accept "}),e.jsx("button",{className:t.btnDanger,onClick:()=>m(s.user),children:" Reject "})]})]},n)):e.jsx("li",{children:"No pending requests received"})}),a&&e.jsx("p",{className:t.feedback,children:a})]});case"remove":return e.jsxs("div",{className:t.section,children:[e.jsx("h2",{children:"Remove Friend"}),e.jsx("ul",{className:t.friendList,children:i.filter(s=>s.status==="accepted").length?i.filter(s=>s.status==="accepted").map((s,n)=>e.jsxs("li",{className:t.friendBar,children:[e.jsx("span",{children:s.displayName||"Unknown"}),e.jsx("button",{className:t.btnDanger,onClick:()=>N(s.user),children:" Remove "})]},n)):e.jsx("li",{children:"No friends to remove"})}),a&&e.jsx("p",{className:t.feedback,children:a})]});default:return null}};return e.jsxs("div",{className:t.container,children:[e.jsx(k,{}),e.jsxs("div",{className:t.page,children:[e.jsx("h1",{className:t.title,children:"Manage Friends"}),e.jsxs("div",{className:t.tabs,children:[e.jsx("button",{className:`${t.tab} ${o==="add"?t.active:""}`,onClick:()=>u("add"),children:"Add Friend"}),e.jsx("button",{className:`${t.tab} ${o==="sent"?t.active:""}`,onClick:()=>u("sent"),children:" Pending Sent "}),e.jsx("button",{className:`${t.tab} ${o==="received"?t.active:""}`,onClick:()=>u("received"),children:" Pending Received"}),e.jsx("button",{className:`${t.tab} ${o==="remove"?t.active:""}`,onClick:()=>u("remove"),children:"Remove Friend "})]}),e.jsx("div",{className:t.content,children:f()}),e.jsx("button",{className:t.btnBack,onClick:()=>h("/friends"),children:" ← Back to Friends "})]}),e.jsx(C,{})]})}export{O as default};
