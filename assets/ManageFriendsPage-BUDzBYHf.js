import{r,A as y,u as B,j as s,L as F,H as w,F as L,a as o,h as $}from"./index-DTw5IBFM.js";const P="_container_6hq6f_1",A="_page_6hq6f_11",S="_title_6hq6f_22",U="_tabs_6hq6f_28",E="_tab_6hq6f_28",K="_active_6hq6f_50",M="_content_6hq6f_56",H="_section_6hq6f_64",T="_input_6hq6f_75",O="_friendList_6hq6f_83",V="_btnPrimary_6hq6f_94",z="_btnDanger_6hq6f_109",G="_btnBack_6hq6f_123",J="_feedback_6hq6f_139",Q="_friendBar_6hq6f_150",W="_friendInfo_6hq6f_165",X="_buttonContainer_6hq6f_172",Y="_friendImage_6hq6f_181",Z="_avatar_6hq6f_190",ee="_friendName_6hq6f_199",se="_friendId_6hq6f_205",ne="_friendLink_6hq6f_210",n={container:P,page:A,title:S,tabs:U,tab:E,active:K,content:M,section:H,input:T,friendList:O,btnPrimary:V,btnDanger:z,btnBack:G,feedback:J,friendBar:Q,friendInfo:W,buttonContainer:X,friendImage:Y,avatar:Z,friendName:ee,friendId:se,friendLink:ne};function ie(){const{user:i}=r.useContext(y),g=B(),[l,u]=r.useState("add"),[x,j]=r.useState(""),[a,c]=r.useState(""),[f,v]=r.useState(null),[N,_]=r.useState(!0);if(r.useEffect(()=>{(async()=>{if(i?.publicID){_(!0);try{const m={...(await o.post("undefined/api/users/friendlist",{publicID:i.publicID})).data.friends},R=await Promise.all((m.User||[]).map(async b=>{const D=await o.get(`undefined/api/users/${encodeURIComponent(b.user)}`);return{...b,...D.data.user}}));m.User=R,v(m)}catch(t){console.error("Failed to fetch friends:",t)}finally{_(!1)}}})()},[i]),N)return s.jsx(F,{});const d=f?Object.values(f).flat().filter(e=>e.source==="User"):[],q=async e=>{try{const t=await o.post(`undefined/friends/add/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Request sent!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},I=async e=>{try{const t=await o.post(`undefined/friends/accept/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Request accepted!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},p=async e=>{try{const t=await o.post(`undefined/friends/reject/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Request rejected!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},k=async e=>{try{const t=await o.post(`undefined/friends/remove/${encodeURIComponent(e)}`,{publicID:i.publicID});c(t.data.message||"Friend removed!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},h=(e,t)=>s.jsxs("li",{className:n.friendBar,children:[s.jsx("div",{className:n.friendImage,children:s.jsx("img",{src:e.avatar||e.profilePicture||"https://digitalhealthskills.com/wp-content/uploads/2022/11/3da39-no-user-image-icon-27.png",alt:e.displayName||"Friend avatar",className:n.avatar})}),s.jsxs("div",{className:n.friendInfo,children:[s.jsx("div",{className:n.friendName,children:e.displayName||e.name||"Unknown"}),s.jsxs("div",{className:n.friendId,children:["UserID: ",e.publicID]}),s.jsx($,{to:`/friends/viewprofile/${e.publicID}`,className:n.friendLink,children:"View Profile"})]}),s.jsx("div",{className:n.buttonContainer,children:t})]},e.user),C=()=>{switch(l){case"add":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Add Friend"}),s.jsx("input",{type:"text",placeholder:"Enter your friend's Public ID (top right corner)",className:n.input,onChange:e=>j(e.target.value)}),s.jsx("button",{className:n.btnPrimary,onClick:()=>q(x),children:"Send Request"}),a&&s.jsx("p",{className:n.feedback,children:a})]});case"sent":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Pending Requests (Sent)"}),s.jsx("ul",{className:n.friendList,children:d.filter(e=>e.status==="pending"&&e.requestedByMe).length?d.filter(e=>e.status==="pending"&&e.requestedByMe).map(e=>h(e,s.jsx("button",{className:n.btnDanger,onClick:()=>p(e.user),children:"Cancel"}))):s.jsx("li",{children:"No pending requests sent"})}),a&&s.jsx("p",{className:n.feedback,children:a})]});case"received":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Pending Requests (Received)"}),s.jsx("ul",{className:n.friendList,children:d.filter(e=>e.status==="pending"&&!e.requestedByMe).length?d.filter(e=>e.status==="pending"&&!e.requestedByMe).map(e=>h(e,s.jsxs(s.Fragment,{children:[s.jsx("button",{className:n.btnPrimary,onClick:()=>I(e.user),children:"Accept"}),s.jsx("button",{className:n.btnDanger,onClick:()=>p(e.user),children:"Reject"})]}))):s.jsx("li",{children:"No pending requests received"})}),a&&s.jsx("p",{className:n.feedback,children:a})]});case"remove":return s.jsxs("div",{className:n.section,children:[s.jsx("h2",{children:"Remove Friend"}),s.jsx("ul",{className:n.friendList,children:d.filter(e=>e.status==="accepted").length?d.filter(e=>e.status==="accepted").map(e=>h(e,s.jsx("button",{className:n.btnDanger,onClick:()=>k(e.user),children:"Remove"}))):s.jsx("li",{children:"No friends to remove"})}),a&&s.jsx("p",{className:n.feedback,children:a})]});default:return null}};return s.jsxs("div",{className:n.container,children:[s.jsx(w,{}),s.jsxs("div",{className:n.page,children:[s.jsx("h1",{className:n.title,children:"Manage Friends"}),s.jsxs("div",{className:n.tabs,children:[s.jsx("button",{className:`${n.tab} ${l==="add"?n.active:""}`,onClick:()=>u("add"),children:"Add Friend"}),s.jsx("button",{className:`${n.tab} ${l==="sent"?n.active:""}`,onClick:()=>u("sent"),children:"Pending Sent"}),s.jsx("button",{className:`${n.tab} ${l==="received"?n.active:""}`,onClick:()=>u("received"),children:"Pending Received"}),s.jsx("button",{className:`${n.tab} ${l==="remove"?n.active:""}`,onClick:()=>u("remove"),children:"Remove Friend"})]}),s.jsx("div",{className:n.content,children:C()}),s.jsx("button",{className:n.btnBack,onClick:()=>g("/friends"),children:"â† Back to Friends"})]}),s.jsx(L,{})]})}export{ie as default};
