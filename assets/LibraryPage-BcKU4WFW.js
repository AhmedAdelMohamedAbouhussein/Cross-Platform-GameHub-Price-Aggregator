import{g as k,j as e,u as E,r as d,A as L,L as W,H as F,c as G,F as A,a as b}from"./index-DTw5IBFM.js";import{A as I}from"./Aside-CE7qS0Cu.js";import"./index-OaW0WkL9.js";var T={exports:{}},w,C;function D(){if(C)return w;C=1;var s="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return w=s,w}var P,R;function q(){if(R)return P;R=1;var s=D();function i(){}function n(){}return n.resetWarningCache=i,P=function(){function r(p,y,g,l,x,a){if(a!==s){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}r.isRequired=r;function t(){return r}var c={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:t,element:r,elementType:r,instanceOf:t,node:r,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:n,resetWarningCache:i};return c.PropTypes=c,c},P}var N;function z(){return N||(N=1,T.exports=q()()),T.exports}var B=z();const f=k(B),$="_card_1mlff_1",M="_defaultOverlay_1mlff_30",H="_progressWrapper_1mlff_40",U="_cardImage_1mlff_59",K="_classTitle_1mlff_78",m={card:$,defaultOverlay:M,progressWrapper:H,cardImage:U,classTitle:K},V="_progressCircle_q6ean_1",Y="_progressCircleText_q6ean_12",O={progressCircle:V,progressCircleText:Y};function J({progress:s}){const r=2*Math.PI*45,t=r*(1-s/100);return e.jsxs("svg",{width:"100",height:"100",className:O.progressCircle,children:[e.jsx("circle",{cx:"50",cy:"50",r:45,stroke:"#e6e6e6",strokeWidth:10,fill:"none"}),e.jsx("circle",{cx:"50",cy:"50",r:45,stroke:"#4caf50",strokeWidth:10,fill:"none",strokeDasharray:r,strokeDashoffset:t,strokeLinecap:"round",transform:"rotate(-90 50 50)"}),e.jsxs("text",{x:"50%",y:"50%",textAnchor:"middle",dy:"0.3em",className:O.progressCircleText,children:[s,"%"]})]})}function S(s){const i=s.id,n=s.platform.trim(),r=s.title,t=s.image.trim()!==""?s.image:"https://static.vecteezy.com/system/resources/previews/008/255/804/non_2x/page-not-found-error-404-system-updates-uploading-computing-operation-installation-programs-system-maintenance-graffiti-sprayed-page-not-found-error-404-isolated-on-white-background-vector.jpg",c=s.progress,p=s.lastPlayed?new Date(s.lastPlayed).toLocaleDateString():"Game hasn't been played",y=s.hoursPlayed,g=E(),l=d.useRef(null),[x,a]=d.useState(!1);return d.useEffect(()=>{const o=new IntersectionObserver(v=>{v.forEach(j=>{j.isIntersecting&&(console.log(`Card ${r} is now visible`),a(!0),o.disconnect())})},{threshold:.2});return l.current&&o.observe(l.current),()=>{l.current&&o.unobserve(l.current)}},[]),e.jsx("div",{ref:l,className:m.card,onClick:()=>g(`/ownedgamedetails?platform=${n}&id=${i}`),children:x?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t,alt:r+" picture",loading:"lazy",className:m.cardImage}),e.jsx("h2",{className:m.classTitle,children:s.title}),e.jsxs("p",{children:["Bought on: ",n]}),e.jsx("div",{className:m.progressWrapper,children:e.jsx(J,{progress:c})}),e.jsx("div",{className:m.defaultOverlay,children:e.jsx("p",{children:"Hover to see progress"})}),e.jsxs("p",{children:["Total Hours: ",y]}),e.jsxs("p",{children:["Last Played: ",p]})]}):e.jsx("div",{className:m.placeholder,children:"Loading..."})})}S.propTypes={title:f.string.isRequired,image:f.string,platform:f.string,progress:f.number,lastPlayed:f.oneOfType([f.string,f.instanceOf(Date)])};const Q="_container_1xwzh_1",X="_body_1xwzh_9",Z="_main_1xwzh_15",ee="_toppanel_1xwzh_23",re="_refreshButton_1xwzh_26",se="_spin_1xwzh_44",te="_cardGrid_1xwzh_54",h={container:Q,body:X,main:Z,toppanel:ee,refreshButton:re,spin:se,cardGrid:te};function ce(){const{user:i}=d.useContext(L),[n,r]=d.useState(null),[t,c]=d.useState(!0),[p,y]=d.useState(!1),g=async()=>{c(!0);try{const a=await b.post("undefined/api/users/ownedgames",{},{withCredentials:!0});r(a.data.ownedGames)}catch(a){console.error("Fetch failed:",a)}finally{c(!1)}};d.useEffect(()=>{window.scrollTo(0,0),i&&g()},[i]);const l=async()=>{if(!p){y(!0);try{await b.post("undefined/refresh/refreshOwnedGames",{},{withCredentials:!0}),await g()}catch(a){console.error("Failed to refresh games:",a)}finally{y(!1)}}},x=()=>{if(!n)return null;const a=new Map(Object.entries(n));return Array.from(a.entries()).flatMap(([o,v])=>{const j=new Map(Object.entries(v));return Array.from(j.entries()).sort((_,u)=>u[1].progress-_[1].progress).map(([_,u])=>e.jsx(S,{id:_,platform:o,image:u.coverImage,title:u.gameName,progress:u.progress,lastPlayed:u.lastPlayed,hoursPlayed:u.hoursPlayed},`${o}-${_}`))})};return t?e.jsx(W,{}):e.jsxs("div",{className:h.container,children:[e.jsx(F,{}),e.jsxs("div",{className:h.body,children:[e.jsx(I,{}),e.jsxs("main",{className:h.main,children:[e.jsx("div",{className:h.toppanel,children:e.jsxs("button",{className:h.refreshButton,onClick:l,disabled:p,children:[e.jsx(G,{className:p?h.spin:""}),p?" Refreshing...":" Refresh Library"]})}),e.jsx("div",{className:h.cardGrid,children:x()})]})]}),e.jsx(A,{})]})}export{ce as default};
