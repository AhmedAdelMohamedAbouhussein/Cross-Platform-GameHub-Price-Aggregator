import{g as I,j as e,b as O,r as u,A as S,H as E,c as G,F as k,a as w}from"./index-BLBKctUd.js";import{A as F}from"./Aside-_fW4xaRY.js";import"./index-Dj-_Ghcu.js";var v={exports:{}},j,b;function W(){if(b)return j;b=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return j=r,j}var T,P;function A(){if(P)return T;P=1;var r=W();function o(){}function i(){}return i.resetWarningCache=o,T=function(){function s(y,x,n,t,_,g){if(g!==r){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}s.isRequired=s;function a(){return s}var l={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:a,element:s,elementType:s,instanceOf:a,node:s,objectOf:a,oneOf:a,oneOfType:a,shape:a,exact:a,checkPropTypes:i,resetWarningCache:o};return l.PropTypes=l,l},T}var R;function L(){return R||(R=1,v.exports=A()()),v.exports}var D=L();const p=I(D),q="_card_1mlff_1",B="_defaultOverlay_1mlff_30",$="_progressWrapper_1mlff_40",z="_cardImage_1mlff_59",M="_classTitle_1mlff_78",h={card:q,defaultOverlay:B,progressWrapper:$,cardImage:z,classTitle:M},U="_progressCircle_q6ean_1",H="_progressCircleText_q6ean_12",C={progressCircle:U,progressCircleText:H};function K({progress:r}){const s=2*Math.PI*45,a=s*(1-r/100);return e.jsxs("svg",{width:"100",height:"100",className:C.progressCircle,children:[e.jsx("circle",{cx:"50",cy:"50",r:45,stroke:"#e6e6e6",strokeWidth:10,fill:"none"}),e.jsx("circle",{cx:"50",cy:"50",r:45,stroke:"#4caf50",strokeWidth:10,fill:"none",strokeDasharray:s,strokeDashoffset:a,strokeLinecap:"round",transform:"rotate(-90 50 50)"}),e.jsxs("text",{x:"50%",y:"50%",textAnchor:"middle",dy:"0.3em",className:C.progressCircleText,children:[r,"%"]})]})}function N(r){const o=r.id,i=r.platform.trim(),s=r.title,a=r.image.trim()!==""?r.image:"https://static.vecteezy.com/system/resources/previews/008/255/804/non_2x/page-not-found-error-404-system-updates-uploading-computing-operation-installation-programs-system-maintenance-graffiti-sprayed-page-not-found-error-404-isolated-on-white-background-vector.jpg",l=r.progress,y=r.lastPlayed?new Date(r.lastPlayed).toLocaleDateString():"Game hasn't been played",x=r.hoursPlayed,n=O(),t=u.useRef(null),[_,g]=u.useState(!1);return u.useEffect(()=>{const d=new IntersectionObserver(f=>{f.forEach(c=>{c.isIntersecting&&(console.log(`Card ${s} is now visible`),g(!0),d.disconnect())})},{threshold:.2});return t.current&&d.observe(t.current),()=>{t.current&&d.unobserve(t.current)}},[]),e.jsx("div",{ref:t,className:h.card,onClick:()=>n(`/ownedgamedetails?platform=${i}&id=${o}`),children:_?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:a,alt:s+" picture",loading:"lazy",className:h.cardImage}),e.jsx("h2",{className:h.classTitle,children:r.title}),e.jsxs("p",{children:["Bought on: ",i]}),e.jsx("div",{className:h.progressWrapper,children:e.jsx(K,{progress:l})}),e.jsx("div",{className:h.defaultOverlay,children:e.jsx("p",{children:"Hover to see progress"})}),e.jsxs("p",{children:["Total Hours: ",x]}),e.jsxs("p",{children:["Last Played: ",y]})]}):e.jsx("div",{className:h.placeholder,children:"Loading..."})})}N.propTypes={title:p.string.isRequired,image:p.string,platform:p.string,progress:p.number,lastPlayed:p.oneOfType([p.string,p.instanceOf(Date)])};const V="_container_1xwzh_1",Y="_body_1xwzh_9",J="_main_1xwzh_15",Q="_toppanel_1xwzh_23",X="_refreshButton_1xwzh_26",Z="_spin_1xwzh_44",ee="_cardGrid_1xwzh_54",m={container:V,body:Y,main:J,toppanel:Q,refreshButton:X,spin:Z,cardGrid:ee};function ae(){const{user:o}=u.useContext(S),[i,s]=u.useState(null);u.useEffect(()=>{window.scrollTo(0,0);const n=async()=>{try{const t=await w.post("undefined/api/users/ownedgames",{userId:o._id});s(t.data.ownedGames),console.log("Fetched owned games:",t.data.ownedGames)}catch(t){console.error("Fetch failed:",t)}};o?._id&&n()},[]);const[a,l]=u.useState(!1),y=async()=>{if(!a){l(!0);try{const n={userId:o._id};o.steamId&&(n.steamId=o.steamId),o.xboxId&&(n.xboxId=o.xboxId),console.log("Refreshing owned games with body:",n),await w.post("undefined/refresh/refreshOwnedGames",n);const t=await w.post("undefined/api/users/ownedgames",{userId:o._id});s(t.data.ownedGames),console.log("Refreshed owned games:",t.data.ownedGames)}catch(n){console.error("Failed to refresh games:",n)}finally{l(!1)}}},x=()=>{if(!i)return e.jsx("p",{children:"Loading games..."});const n=new Map(Object.entries(i));return Array.from(n.entries()).flatMap(([t,_])=>{const g=new Map(Object.entries(_));return Array.from(g.entries()).sort((f,c)=>c[1].progress-f[1].progress).map(([f,c])=>e.jsx(N,{id:f,platform:t,image:c.coverImage,title:c.gameName,progress:c.progress,lastPlayed:c.lastPlayed,hoursPlayed:c.hoursPlayed},`${t}-${f}`))})};return e.jsxs("div",{className:m.container,children:[e.jsx(E,{}),e.jsxs("div",{className:m.body,children:[e.jsx(F,{}),e.jsxs("main",{className:m.main,children:[e.jsx("div",{className:m.toppanel,children:e.jsxs("button",{className:m.refreshButton,onClick:y,disabled:a,children:[e.jsx(G,{className:a?m.spin:""}),a?" Refreshing...":" Refresh Library"]})}),e.jsx("div",{className:m.cardGrid,children:x()})]})]}),e.jsx(k,{})]})}export{ae as default};
