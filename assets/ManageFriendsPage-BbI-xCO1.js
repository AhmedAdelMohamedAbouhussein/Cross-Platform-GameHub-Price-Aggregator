import{r as d,A as v,b as q,j as e,H as C,F as k,a as l}from"./index-CsEmHfSi.js";const R="_container_bz21q_1",y="_page_bz21q_11",B="_title_bz21q_22",D="_tabs_bz21q_28",w="_tab_bz21q_28",$="_active_bz21q_50",z="_content_bz21q_56",A="_section_bz21q_64",F="_input_bz21q_75",I="_friendList_bz21q_83",U="_friendBar_bz21q_94",P="_btnPrimary_bz21q_109",S="_btnDanger_bz21q_124",E="_btnBack_bz21q_138",L="_feedback_bz21q_154",K="_buttonContainer_bz21q_165",n={container:R,page:y,title:B,tabs:D,tab:w,active:$,content:z,section:A,input:F,friendList:I,friendBar:U,btnPrimary:P,btnDanger:S,btnBack:E,feedback:L,buttonContainer:K};function O(){const{user:i}=d.useContext(v),p=q(),[o,u]=d.useState("add"),[h,_]=d.useState(""),[a,c]=d.useState(""),[b,x]=d.useState(null);d.useEffect(()=>{const s=async()=>{try{const t=await l.post("undefined/api/users/friendlist",{userId:i._id});x(t.data.friends),console.log("Fetched friends:",t.data.friends)}catch(t){console.error("Failed to fetch friends:",t)}};i?._id&&s()},[]);const r=b?Object.values(b).flat().filter(s=>s.source==="User"):[],j=async s=>{try{const t=await l.post(`undefined/friends/add/${encodeURIComponent(s)}`,{publicID:i.publicID});c(t.data.message||"Request sent!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},g=async s=>{try{const t=await l.post(`undefined/friends/accept/${encodeURIComponent(s)}`,{publicID:i.publicID});c(t.data.message||"Request accepted!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},m=async s=>{try{const t=await l.post(`undefined/friends/reject/${encodeURIComponent(s)}`,{publicID:i.publicID});c(t.data.message||"Request rejected!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},N=async s=>{try{const t=await l.post(`undefined/friends/remove/${encodeURIComponent(s)}`,{publicID:i.publicID});c(t.data.message||"Friend removed!")}catch(t){c(t.response?.data?.message||"Something went wrong.")}},f=()=>{switch(o){case"add":return e.jsxs("div",{className:n.section,children:[e.jsx("h2",{children:"Add Friend"}),e.jsx("input",{type:"text",placeholder:"Enter UserID",className:n.input,onChange:s=>_(s.target.value)}),e.jsx("button",{className:n.btnPrimary,onClick:()=>j(h),children:" Send Request "}),a&&e.jsx("p",{className:n.feedback,children:a})]});case"sent":return e.jsxs("div",{className:n.section,children:[e.jsx("h2",{children:"Pending Requests (Sent)"}),e.jsx("ul",{className:n.friendList,children:r.filter(s=>s.status==="pending"&&s.requestedByMe).length?r.filter(s=>s.status==="pending"&&s.requestedByMe).map((s,t)=>e.jsxs("li",{className:n.friendBar,children:[e.jsx("span",{children:s.displayName||"Unknown"}),e.jsx("button",{className:n.btnDanger,onClick:()=>m(s.user),children:" Cancel "})]},t)):e.jsx("li",{children:"No pending requests sent"})}),a&&e.jsx("p",{className:n.feedback,children:a})]});case"received":return e.jsxs("div",{className:n.section,children:[e.jsx("h2",{children:"Pending Requests (Received)"}),e.jsx("ul",{className:n.friendList,children:r.filter(s=>s.status==="pending"&&!s.requestedByMe).length?r.filter(s=>s.status==="pending"&&!s.requestedByMe).map((s,t)=>e.jsxs("li",{className:n.friendBar,children:[e.jsx("span",{children:s.displayName||"Unknown"}),e.jsxs("div",{className:n.buttonContainer,children:[e.jsx("button",{className:n.btnPrimary,onClick:()=>g(s.user),children:" Accept "}),e.jsx("button",{className:n.btnDanger,onClick:()=>m(s.user),children:" Reject "})]})]},t)):e.jsx("li",{children:"No pending requests received"})}),a&&e.jsx("p",{className:n.feedback,children:a})]});case"remove":return e.jsxs("div",{className:n.section,children:[e.jsx("h2",{children:"Remove Friend"}),e.jsx("ul",{className:n.friendList,children:r.filter(s=>s.status==="accepted").length?r.filter(s=>s.status==="accepted").map((s,t)=>e.jsxs("li",{className:n.friendBar,children:[e.jsx("span",{children:s.displayName||"Unknown"}),e.jsx("button",{className:n.btnDanger,onClick:()=>N(s.user),children:" Remove "})]},t)):e.jsx("li",{children:"No friends to remove"})}),a&&e.jsx("p",{className:n.feedback,children:a})]});default:return null}};return e.jsxs("div",{className:n.container,children:[e.jsx(C,{}),e.jsxs("div",{className:n.page,children:[e.jsx("h1",{className:n.title,children:"Manage Friends"}),e.jsxs("div",{className:n.tabs,children:[e.jsx("button",{className:`${n.tab} ${o==="add"?n.active:""}`,onClick:()=>u("add"),children:"Add Friend"}),e.jsx("button",{className:`${n.tab} ${o==="sent"?n.active:""}`,onClick:()=>u("sent"),children:" Pending Sent "}),e.jsx("button",{className:`${n.tab} ${o==="received"?n.active:""}`,onClick:()=>u("received"),children:" Pending Received"}),e.jsx("button",{className:`${n.tab} ${o==="remove"?n.active:""}`,onClick:()=>u("remove"),children:"Remove Friend "})]}),e.jsx("div",{className:n.content,children:f()}),e.jsx("button",{className:n.btnBack,onClick:()=>p("/friends"),children:" ← Back to Friends "})]}),e.jsx(k,{})]})}export{O as default};
